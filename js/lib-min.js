Line=function(e,t){this.setOrigin(e),this.setDirection(t)},Line.prototype={setOrigin:function(e){this.origin=e},getOrigin:function(){return this.origin},setDirection:function(e){this.direction=e},getDirection:function(e){return this.direction},projection:function(e){var t="getDirection";return p0p=new Vector(this.getOrigin().getx(),this.getOrigin().gety(),e.getx(),e.gety()),directionLength=this[t]().length(),scalefactor=p0p.dot(this[t]())/(directionLength*directionLength),result=this[t]().clone(),result.scale(scalefactor),result},distance:function(e){return p0p=new Vector(this.getOrigin().getx(),this.getOrigin().gety(),e.getx(),e.gety()),Math.abs(this.getDirection().cross(p0p))/this.getDirection().length()}},Vector=function(e,t,n,r){!n||!r?(this.setx(e),this.sety(t)):(this.setx(n-e),this.sety(r-t))},Vector.prototype={clone:function(){return new Vector(this.getx(),this.gety())},newFromVector:function(e){return new Vector(this.getx(),this.gety(),e.getx(),e.gety())},setx:function(e){this.x=e},getx:function(){return this.x},sety:function(e){this.y=e},gety:function(){return this.y},add:function(e){this.x+=e.getx(),this.y+=e.gety()},sub:function(e){this.x-=e.getx(),this.y-=e.gety()},dot:function(e){return this.x*e.getx()+this.y*e.gety()},scale:function(e){this.x*=e,this.y*=e},cross:function(e){return this.x*e.y-this.y*e.x},length:function(){return Math.sqrt(this.dot(this))},unit:function(){var e=this.length();return unitx=this.x/e,unity=this.y/e,new Vector(unitx,unity)}},Util=function(){var e="Solr\u00f8d Str.",t="Karlslunde",n="Greve",r="Hundige",i="Ish\u00f8j",s="Friheden",o="Ny Ellebjerg",u="Sj\u00e6l\u00f8r",a="Sydhavn",f="Dybb\u00f8lsbro",l="K\u00f8benhavn H",c="Vesterport",h="N\u00f8rreport",p="\u00d8sterport",d="Nordhavn",v="Svanem\u00f8llen",m="Ryparken",g="Vangede",y="Buddinge",b="Steng\u00e5rden",w="Bagsv\u00e6rd",E="Hareskov",S="V\u00e6rl\u00f8se",x="Farum",T="H\u00f8je Taastrup",N="Taastrup",C="Albertslund",k="Glostrup",L="Dansh\u00f8j",A="Valby",O="Enghave",M="Hellerup",_="Lyngby",D="Holte",P="Frederikssund",H="\u00d8lstykke",B="Egedal",j="Stenl\u00f8se",F="Veks\u00f8",I="M\u00e5l\u00f8v",q="Ballerup",R="Malmparken",U="Herlev",z="Husum",W="Vanl\u00f8se",X="Flintholm",V="convertCoordinatesToVectors",$="calculateStationsPercentages",J=[{x:1509,y:8647},{x:5675,y:8647},{x:5955,y:9027},{x:6091,y:9137},{x:6264,y:9171},{x:6433,y:9137},{x:6585,y:9028},{x:7920,y:7147},{x:7959,y:7062},{x:7965,y:6985},{x:7917,y:6853},{x:7580,y:6289},{x:7581,y:1122}],K=[{name:e,x:1509,y:8647},{name:t,x:1797,y:8647},{name:n,x:2075,y:8647},{name:r,x:2357,y:8647},{name:i,x:2637,y:8647},{name:"Vallensb\u00e6k",x:2913,y:8647},{name:"Br\u00f8ndby Str.",x:3194,y:8647},{name:"Aved\u00f8re",x:3472,y:8647},{name:s,x:3752,y:8647},{name:"\u00c5marken",x:4031,y:8647},{name:o,x:4317,y:8647},{name:u,x:4596,y:8647},{name:a,x:4876,y:8647},{name:f,x:5748,y:8747},{name:l,x:6896,y:8590},{name:c,x:7090,y:8317},{name:h,x:7290,y:8035},{name:p,x:7485,y:7759},{name:d,x:7681,y:7483},{name:v,x:7882,y:7200},{name:m,x:7580,y:6108},{name:"Emdrup",x:7580,y:5132},{name:"Dysseg\u00e5rd",x:7580,y:4742},{name:g,x:7581,y:4352},{name:"Kildebakke",x:7581,y:3962},{name:y,x:7581,y:3567},{name:b,x:7581,y:3176},{name:w,x:7581,y:2782},{name:"Skovbrynet",x:7581,y:2389},{name:E,x:7581,y:1996},{name:S,x:7581,y:1601},{name:x,x:7581,y:1122}],Q=[{x:2355,y:7635},{x:5249,y:7635},{x:6035,y:8748},{x:6134,y:8851},{x:6258,y:8901},{x:6389,y:8854},{x:6479,y:8781},{x:8188,y:6355},{x:8191,y:2715}],G=[{name:T,x:2355,y:7635},{name:N,x:2639,y:7635},{name:C,x:2919,y:7635},{name:k,x:3199,y:7635},{name:"Br\u00f8ndby\u00f8ster",x:3480,y:7635},{name:"R\u00f8dovre",x:3758,y:7635},{name:"Hvidovre",x:4035,y:7635},{name:L,x:4315,y:7635},{name:A,x:5497,y:7986},{name:O,x:5695,y:8266},{name:f,x:5893,y:8547},{name:l,x:6750,y:8397},{name:c,x:6947,y:8117},{name:h,x:7146,y:7834},{name:p,x:7339,y:7560},{name:d,x:7536,y:7280},{name:v,x:7730,y:7005},{name:M,x:7943,y:6703},{name:"Bernstorffsvej",x:8189,y:5137},{name:"Gentofte",x:8189,y:4742},{name:"J\u00e6gersborg",x:8190,y:4347},{name:_,x:8190,y:3962},{name:"Sorgenfri",x:8190,y:3564},{name:"Virum",x:8190,y:3176},{name:D,x:8191,y:2715}],Y=[{x:2362,y:7495},{x:5301,y:7497},{x:6094,y:8630},{x:6166,y:8706},{x:6262,y:8751},{x:6355,y:8719},{x:6433,y:8655},{x:7266,y:7466}],Z=[{name:T,x:2362,y:7495},{name:N,x:2639,y:7495},{name:C,x:2920,y:7495},{name:k,x:3197,y:7495},{name:L,x:4314,y:7496},{name:A,x:5566,y:7876},{name:O,x:5766,y:8162},{name:f,x:5964,y:8444},{name:l,x:6682,y:8299},{name:c,x:6880,y:8017},{name:h,x:7075,y:7738},{name:p,x:7266,y:7466}],et=[{x:4181,y:325},{x:4181,y:5708},{x:6148,y:8506},{x:6206,y:8568},{x:6269,y:8606},{x:6339,y:8563},{x:6380,y:8508},{x:8053,y:6146},{x:8484,y:6146},{x:8965,y:5460}],tt=[{name:P,x:4181,y:325},{name:H,x:4181,y:816},{name:B,x:4181,y:1210},{name:j,x:4181,y:1601},{name:F,x:4181,y:1996},{name:"Kildedal",x:4181,y:2391},{name:I,x:4181,y:2781},{name:q,x:4181,y:3172},{name:R,x:4181,y:3569},{name:"Skovlunde",x:4181,y:3962},{name:U,x:4181,y:4350},{name:z,x:4181,y:4744},{name:"Islev",x:4181,y:5139},{name:"Jyllingevej",x:4430,y:6062},{name:W,x:4595,y:6296},{name:X,x:4759,y:6530},{name:"Peter Bangs Vej",x:5092,y:7003},{name:"Langgade",x:5290,y:7285},{name:A,x:5640,y:7783},{name:O,x:5837,y:8063},{name:f,x:6031,y:8340},{name:l,x:6604,y:8192},{name:c,x:6803,y:7910},{name:h,x:6999,y:7634},{name:p,x:7198,y:7353},{name:d,x:7392,y:7079},{name:v,x:7591,y:6798},{name:M,x:7805,y:6496},{name:"Charlottenlund",x:8572,y:6020},{name:"Ordrup",x:8765,y:5746},{name:"Klampenborg",x:8965,y:5460}],nt=[{x:678,y:8503},{x:5721,y:8503},{x:6011,y:8902},{x:6114,y:8991},{x:6259,y:9033},{x:6417,y:8999},{x:6558,y:8882},{x:8284,y:6423},{x:8284,y:1530}],rt=[{name:"K\u00f8ge",x:678,y:8503},{name:"\u00d8lby",x:958,y:8503},{name:"Jersie",x:1237,y:8503},{name:e,x:1520,y:8503},{name:t,x:1800,y:8503},{name:n,x:2080,y:8503},{name:r,x:2357,y:8503},{name:i,x:2632,y:8503},{name:s,x:3754,y:8503},{name:o,x:4316,y:8503},{name:u,x:4596,y:8503},{name:a,x:4874,y:8503},{name:f,x:5820,y:8639},{name:l,x:6825,y:8500},{name:c,x:7027,y:8213},{name:h,x:7220,y:7939},{name:p,x:7414,y:7662},{name:d,x:7612,y:7381},{name:v,x:7811,y:7096},{name:M,x:8019,y:6801},{name:_,x:8284,y:3952},{name:D,x:8284,y:2767},{name:"Birker\u00f8d",x:8284,y:2386},{name:"Aller\u00f8d",x:8284,y:1996},{name:"Hiller\u00f8d",x:8284,y:1530}],it=[{x:4400,y:8411},{x:4397,y:7193},{x:5131,y:6160},{x:7798,y:6155}],st=[{name:o,x:4400,y:8411},{name:"Vigerslev Alle",x:4399,y:7992},{name:L,x:4398,y:7435},{name:"\u00c5lholm",x:4536,y:6998},{name:"KB Hallen",x:4675,y:6801},{name:X,x:4917,y:6462},{name:"Gr\u00f8ndal",x:5969,y:6158},{name:"Fuglebakken",x:6321,y:6158},{name:"N\u00f8rrebro",x:6671,y:6157},{name:"Bispebjerg",x:7022,y:6157},{name:m,x:7371,y:6156},{name:M,x:7798,y:6155}],ot=[{x:4277,y:317},{x:4277,y:5628},{x:6270,y:8473},{x:7546,y:6655},{x:7573,y:6595},{x:7561,y:6548},{x:7476,y:6413},{x:7476,y:1121}],ut=[{name:P,x:4277,y:317},{name:H,x:4277,y:811},{name:B,x:4277,y:1206},{name:j,x:4277,y:1597},{name:F,x:4277,y:1992},{name:I,x:4277,y:2777},{name:q,x:4277,y:3167},{name:R,x:4277,y:3562},{name:U,x:4277,y:4352},{name:z,x:4277,y:4747},{name:W,x:4667,y:6184},{name:X,x:4832,y:6421},{name:A,x:5713,y:7678},{name:O,x:5907,y:7955},{name:f,x:6107,y:8241},{name:l,x:6535,y:8095},{name:c,x:6733,y:7813},{name:h,x:6927,y:7537},{name:p,x:7122,y:7258},{name:d,x:7320,y:6977},{name:v,x:7520,y:6692},{name:m,x:7476,y:6103},{name:g,x:7476,y:4347},{name:y,x:7476,y:3562},{name:b,x:7476,y:3172},{name:w,x:7476,y:2781},{name:E,x:7476,y:1996},{name:S,x:7476,y:1601},{name:x,x:7476,y:1121}];this.tracks={},this[V](J,"A"),this[$](K,"A"),this[V](Q,"B"),this[$](G,"B"),this[V](Y,"BX"),this[$](Z,"BX"),this[V](et,"C"),this[$](tt,"C"),this[V](nt,"E"),this[$](rt,"E"),this[V](it,"F"),this[$](st,"F"),this[V](ot,"H"),this[$](ut,"H")},Util.prototype={convertCoordinatesToVectors:function(e,t){var n=[],r=0;for(var i=0;i<e.length-1;i++){current=e[i],next=e[i+1],start=new Vector(current.x,current.y),end=new Vector(next.x,next.y),direction=new Vector(current.x,current.y,next.x,next.y);var s={start:start,end:end,length:r,line:new Line(start,direction)};r+=direction.length(),n.push(s)}this.tracks[t]={length:r,lines:n}},calculateStationsPercentages:function(e,t){var n=[];for(var r in e){var i=e[r],s=new Vector(i.x,i.y),o=this.findClosestLine(s,t,0),u=this.convertPointToPercentage(s,o,t,0);n.push({name:i.name,percentage:u})}this.tracks[t].stations=n},findClosestLine:function(e,t,n){var r="length",i="newFromVector",s="undefined",o=null,u=this.tracks[t],a=[];for(var f in u.lines){var l=u.lines[f],c=l.start[i](e)[r](),h=l.end[i](e)[r](),p=l.line.distance(e);lineDistance=[],lineDistance.push(c),lineDistance.push(h),lineDistance.push(p),a.push(lineDistance)}var d=[];for(var v=0;v<a[r];v++){var m=a[v][0],g=a[v][1],p=a[v][2];if(typeof d[0]===s||d[0]===o&&typeof d[1]===s||d[1]===o&&typeof d[2]===s||d[2]===o){d[0]=v,d[1]=v,d[2]=v;continue}a[d[0]][0]>m&&(d[0]=v),a[d[1]][1]>g&&(d[1]=v),a[d[2]][2]>p&&(d[2]=v)}return d.sort(),d[1]},convertPointToPercentage:function(e,t,n,r){closestLine=this.tracks[n].lines[t];var i=closestLine.line.projection(e),s=closestLine.length+i.length(),o=this.tracks[n].length;return s/o},getTrainLine:function(e){return e.match(/[a-zA-Z]*/)[0]}};